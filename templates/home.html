{% extends "base.html" %}

{% block content %}
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <ul>
        {% for message in messages %}
          <li> {{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}
  <div class="d-flex">
    <aside>
      <div>
        <a href="/" class="btn">+ Create New</a>
        <ul class="my-3">
          <li class="my-3"><a href="/">Home</a></li>
          <li class="my-3"><a href="">Dashboard</a></li>
          <li class="my-3"><a href="/generate-qrcode">QR codes</a></li>
          <li class="my-3"><a href="/history">History</a></li>
          {% if current_user.is_authenticated %}
            <li><a href="/account-settings">Account Settings</a></li>
          {% endif %}
        </ul>
        {% if current_user.is_authenticated %}
          <form action="/log-out" method="post">
            <button class="w-75">Log Out</button>
          </form>
        {% else %}
          <a class="btn btn-outline-secondary" href="/log-in">Log In</a>
          <a class="btn btn-outline-primary" href="/create-new-account">Sign Up</a>
        {% endif %}
      </div>
    </aside>
    {% block main %}
      <div class="text-center mx-5">
        <h4>TRM URL</h4>
        <form action="" method="post" class="form-control m-4">
          <input class="d-inline" type="url" name="urlInput" id="urlInput" required placeholder="https://example.com/a-long-url" size="60">
          <button class="icon" onclick="pasteFromClipboard()">
            <img src="/static/paste-preview.png" alt="" height="20" width="20">
          </button>
          <button class="icon" onclick="clearInput()">
          <img src="/static/clear.png" alt="" height="20" width="20">
          </button>
          <script>
            function pasteFromClipboard() {
              navigator.clipboard.readText()
                .then(text => {
                  document.getElementById("urlInput").value = text;
                })
                .catch(error => {
                  console.error('Failed to paste from clipboard: ', error);
                });
            }
            function clearInput() {
              document.getElementById("urlInput").value = "";
            }
          </script>
          <button type="submit" class="mt-4">TRM</button>
        </form>
        <div>
          {% if short_url %}
            <div>
              <code id="link">{{ short_url }}
              <button class="copy-btn bg-secondary px-2" data-clipboard-target="#link">
                <img src="/static/clippy.svg" alt="" height="20" width="20">
              </button></code>
              <script>
                var clipboard = new ClipboardJS('.copy-btn');
                clipboard.on('success', function(e) {
                  alert("Copied!")
                  e.clearSelection();
                });
              </script>
            </div>
          {% endif %}
          <div id="target" class="mt-3">
            {% if current_user.is_authenticated and short_url %}
              <button hx-post="{{ url_for('links.generate_qrcode', url=short_url) }}" hx-target="#target">Generate QR code</button>
            {% endif %}
          </div>
        </div>
      </div>
    {% endblock main %}
  </div>
{% endblock %}